/*! doc 2014-07-09 */
var content=document.querySelector("textarea").value;content&&(document.querySelector("#deck").innerHTML=content),Reveal.initialize({controls:!0,progress:!0,history:!0,center:!1,theme:Reveal.getQueryHash().theme,transition:Reveal.getQueryHash().transition||"default",dependencies:[{src:"/lib/reveal/2.6.2/lib/js/classList.js",condition:function(){return!document.body.classList}},{src:"/lib/reveal/2.6.2/plugin/markdown/marked.js",condition:function(){return!!document.querySelector("[data-markdown]")}},{src:"/lib/reveal/2.6.2/plugin/markdown/markdown.js",condition:function(){return!!document.querySelector("[data-markdown]")}},{src:"/lib/reveal/2.6.2/plugin/highlight/highlight.js",async:!0,callback:function(){hljs.initHighlightingOnLoad()}},{src:"/lib/reveal/2.6.2/plugin/zoom-js/zoom.js",async:!0,condition:function(){return!!document.body.classList}},{src:"/lib/reveal/2.6.2/plugin/notes/notes.js",async:!0,condition:function(){return!!document.body.classList}}]}),function(){function a(a){return['<section contenteditable="true" class="future">',a?"<h2>title</h2>":"","</section>"].join("")}var b=[{value:"none",style:"background:none;width:40px;height:34px;",icon:"icon-blocked"},{value:"rgba( 200, 50, 30, .6)",style:"background:rgba( 200, 50, 30 ,.6);width:40px;height:34px;"},{value:"rgba( 50, 200, 90, .4)",style:"background:rgba( 50, 200, 90, .4);width:40px;height:34px;"},{value:"rgba( 0, 0, 0, .6)",style:"background:rgba( 0, 0, 0, .6);width:40px;height:34px;"},{value:"rgba( 255, 255, 255, .6)",style:"background:rgba( 255, 255, 255, .6);width:40px;height:34px;"},{value:"rgba( 22, 152, 213, .6)",style:"background:rgba( 22, 152, 213, .6);width:40px;height:34px;"},{value:"rgba( 22, 213, 75, .6)",style:"background:rgba( 22, 213, 75, .6);width:40px;height:34px;"},{value:"rgba( 12, 25, 77, .6)",style:"background:rgba( 12, 25, 77, .6);width:40px;height:34px;"},{value:"rgba( 180, 50, 140, .6)",style:"background:rgba( 180, 50, 140, .6);width:40px;height:34px;"},{value:"rgba( 255, 122, 0, .6)",style:"background:rgba( 255, 122, 0, .6);width:40px;height:34px;"}],c=[{icon:"icon-undo",action:"",value:"undo",tip:"撤销"},{icon:"icon-redo",action:"",value:"redo",tip:"重做"},{icon:"icon-bold",action:"",value:"bold",tip:"加粗"},{icon:"icon-italic",action:"",value:"italic",tip:"斜体"},{icon:"icon-underline",action:"",value:"underline",tip:"下划线"},{icon:"icon-paragraph-center2",action:"",value:"",buttons:[{icon:"icon-paragraph-left2",action:"",value:"justifyleft",tip:"左对齐"},{icon:"icon-paragraph-center2",action:"",value:"justifycenter",tip:"居中"},{icon:"icon-paragraph-right2",action:"",value:"justifyright",tip:"右对齐"},{icon:"icon-paragraph-justify2",action:"",value:"justifyfull",tip:"分散对齐"}]},{icon:"icon-list",action:"",value:"insertunorderedlist",tip:"无序列表"},{icon:"icon-numbered-list",action:"",value:"insertorderedlist",tip:"有序列表"},{icon:"icon-embed",action:"",value:"formatBlock","buttons-dir":"v-box",buttons:[{text:"Paragraph",action:"",value:"p"},{text:"pre",action:"",value:"pre"},{text:"code",action:"",value:"code"},{text:"heading1",action:"",value:"h1"},{text:"heading2",action:"",value:"h2"},{text:"heading3",action:"",value:"h3"}]},{icon:"icon-font",action:"",value:"fontSize","buttons-dir":"v-box",buttons:[{text:"18px",action:"",value:"1"},{text:"24px",action:"",value:"2"},{text:"32px",action:"",value:"3"},{text:"42px",action:"",value:"4"},{text:"54px",action:"",value:"5"},{text:"72px",action:"",value:"6"},{text:"112px",action:"",value:"7"}]},{icon:"icon-droplet",action:"",value:"forecolor",tip:"字体颜色","buttons-dir":"v-box",buttons:b},{icon:"icon-droplet",action:"",value:"backcolor",tip:"字体背景色","buttons-dir":"v-box",buttons:b},{icon:"icon-link",action:"createLink",value:"",tip:"链接"},{icon:"icon-link",action:"",value:"unlink",tip:"取消链接"},{icon:"icon-image",action:"insertImage",value:"",tip:"图片"},{icon:"icon-paint-format",action:"",value:"removeFormat",tip:"清除样式"}],d=[{icon:"icon-remove2",action:"delete",value:"",tip:"删除当前片段"},{icon:"icon-droplet",action:"setBackgroundColor",value:"",tip:"背景颜色",buttons:b},{icon:"icon-image2",action:"setBackground",value:"",tip:"背景图"},{icon:"icon-plus",action:"",value:"",tip:"设置fragment"},{icon:"icon-pushpin",action:"position",value:"",tip:"定位"},{icon:"icon-code",action:"editHtml",value:"",tip:"编辑html"}],e={createLink:function(a){var b=$("#link-box");return"Range"!==document.getSelection().type?void $.prompt({type:"warning",content:"请选中需要添加链接的文字"}):(document.execCommand("createlink",!1,"createLink"),$.fixed(a,b),b.fadeIn(),b.inputBox("focus"),void $(document).on("mousedown.link-box",function(a){if(!$.contains(b[0],a.target)){var c=$("a[href=createLink]");c.each(function(a,b){$(b.childNodes).unwrap()}),$(document).off("mousedown.link-box"),b.fadeOut()}}))},insertImage:function(a){var b=$("#img-box");return"None"===document.getSelection().type?void $.prompt({type:"warning",content:"请指定插入图片的地方"}):(document.execCommand("insertimage",!1,"insertimage"),$.fixed(a,b),b.fadeIn(),b.inputBox("focus"),void $(document).on("mousedown.img-box",function(a){if(!$.contains(b[0],a.target)){var c=$("img[src=insertimage]");c.remove(),$(document).off("mousedown.img-box"),b.fadeOut()}}))}},f={"delete":function(){1!==$("section").length&&$.msg({type:"danger",msg:"确认删除当前片段？",ok:function(){var a=$("section.present"),b="prev";Reveal.isFirstSlide()&&(b="next"),a.length>2&&1===a.filter(".stack").children().length?a.remove():a.not(".stack").remove(),Reveal.sync(),Reveal[b]()}})},editHtml:function(){var a=$("section.present:not(.stack)").html();hljs.highlightBlock($("#html-box").modal("open").find("textarea").val(a)[0])},setBackground:function(a){var b=$("#background-box");$.fixed(a,b,{dir:"l",x:-50}),b.fadeIn(),b.inputBox("focus"),$(document).on("mousedown.background-box",function(a){$.contains(b[0],a.target)||($(document).off("mousedown.background-box"),b.fadeOut())})},setBackgroundColor:function(a){var b=a.data("value");b&&($("section.present:not(.stack)").attr("data-background-color",b),Reveal.sync())},position:function(){$("#deck,#topbar,#rightbar,.add-slide,.add-fragment").addClass("preview"),$("#prompt-box").addClass("editing")}},g={$reveal:$(".reveal"),$slidebar:$("#slidebar"),$topbar:$("#topbar"),$rightbar:$("#rightbar"),bindEvent:function(){var b=this,c=b.$reveal.find(".slides");$(".add-slide").click(function(){c.find(">section.present").after(a(!0)),Reveal.sync(),Reveal.right()}),$(".add-fragment").click(function(){var b=c.find("section.present").eq(0);b.hasClass("stack")?b.find(".present").after(a(!0)):b.parent().hasClass("stack")?b.after(a(!0)):(b.children().wrap(a()),b.append(a(!0)),b.addClass("present")),Reveal.sync(),Reveal.down()}),$(".save-btn").click(function(){$("#save-box").modal("open").inputBox("focus")}),$(".account-btn").click(function(){var a=$("#account-box");$.fixed($(this),a,{dir:"t",x:84}),a.fadeIn(),$(document).on("mousedown.account-box",function(b){$.contains(a[0],b.target)||($(document).off("mousedown.account-box"),a.fadeOut())})}),$("#save-box").modal({width:300,title:"保存",button:[{text:"提交",type:"primary",click:function(){var a=$("#save-box").inputBox("data",{valid:!0}),b="/post/add/deck";a&&(a._id?b="post/update/deck":delete a._id,a.content=$("#deck").clone().find("section").removeAttr("contenteditable").end().html(),$.docsajax({url:b,method:"post",data:a,success:function(b){$.prompt({type:"success",content:"保存成功"}),a._id||$("#save-box").find("[name=_id]").val(b.deck._id),$("#save-box").modal("close")}}))}}]}),$(".preview-btn").click(function(){$("#deck,#slidebar,#topbar,#rightbar,.add-fragment,.add-slide").addClass("preview"),$("#deck").find("section").removeAttr("contenteditable"),setTimeout("Reveal.layout()",300)}),$(".edit-btn").click(function(){$("#deck,#slidebar,#topbar,#rightbar,.add-fragment,.add-slide").removeClass("preview"),$("#deck").find("section").prop("contenteditable",!0),setTimeout("Reveal.layout()",300)}),$("#link-box").inputBox({button:$(".add-link-btn")}),$(".add-link-btn").mousedown(function(a){a.preventDefault()}).click(function(){var a=$("#link-box").inputBox("data",{valid:!0});a&&($("a[href=createLink]").attr("href",a.link),$(document).trigger("mousedown.link-box"))}),$("#img-box").inputBox({button:$(".add-img-btn")}),$(".add-img-btn").mousedown(function(a){a.preventDefault()}).click(function(){var a=$("#img-box").inputBox("data",{valid:!0});a&&($("img[src=insertimage]").attr("src",a.img),$(document).trigger("mousedown.img-box"))}),$(".opera-btn").click(function(){$("#deck,#topbar,#rightbar,.add-slide,.add-fragment").removeClass("preview"),$("#prompt-box").removeClass("editing")})},initSlideDetail:function(){var a=this,b=$(".slide-detail"),c=$(document);a.$slidebar.find(".slide-con").on("click",".btn",function(){var a=$(this).index();b.filter(".active").animate({left:"-100%"},function(){$(this).removeClass("active")}),b.eq(a).addClass("active").animate({left:150})}),c.on("mousedown",function(){b.filter(".active").animate({left:"-100%"},function(){$(this).removeClass("active")})})},initTopbar:function(){var a=this;a.$topbar.on("mousedown",".btn",function(a){a.preventDefault()}),a.$topbar.on("click",".btn",function(){var a=$(this),b=a.data("action"),c=a.data("value");return b in e?e[b](a):c&&"none"===c&&(c=none),a.parent().hasClass("btn-wrap-box")&&a.parent().prev().data("value")?document.execCommand(a.parent().prev().data("value"),!1,c):document.execCommand(c),!1}),a.$topbar.find(".btn-group").html($.map(c,function(a){var b=$("<button>",{"class":"btn"});return b.attr("data-tip",a.tip).data(a).append($("<span>").addClass(a.icon)),a.buttons&&(b.attr("data-alignment","l"),b=$('<span class="btn-wrap">').append(b).append($('<div class="btn-wrap-box">').append($.map(a.buttons,function(a){var b=$("<button>",{"class":"btn"});return b.attr("data-tip",a.tip).data(a),a.style&&b.attr("style",a.style),a.icon?b.append($("<span>").addClass(a.icon)):b.text(a.text),b}))),a["buttons-dir"]&&b.find(".btn-wrap-box").addClass(a["buttons-dir"])),b}))},initRightbar:function(){var a=this;a.$rightbar.on("mousedown",".btn",function(a){a.preventDefault()}),a.$rightbar.on("click",".btn",function(){var a=$(this),b=a.data("value"),c=a.data("action");b&&a.parent().hasClass("btn-wrap-box")&&(c=a.parent().prev().data("action")),c in f&&f[c](a)}),a.$rightbar.find(".btn-group").html($.map(d,function(a){var b=$("<button>",{"class":"btn"});return b.attr("data-tip",a.tip).data(a).append($("<span>").addClass(a.icon)),a.buttons||b.attr("data-alignment","l"),a.buttons&&(b=$('<span class="btn-wrap">').append(b).append($('<div class="btn-wrap-box">').append($.map(a.buttons,function(a){var b=$("<button>",{"class":"btn"});return b.attr("data-tip",a.tip).data(a),a.style&&b.attr("style",a.style),a.icon?b.append($("<span>").addClass(a.icon)):b.text(a.text),b}))),a["buttons-dir"]&&b.find(".btn-wrap-box").addClass(a["buttons-dir"])),b})),a.$rightbar.find(".btn-group >.btn:last-child").one("click",function(){$("#html-box").modal({width:600,height:400,title:"编辑html",button:[{text:"确定",type:"primary",click:function(){var a=$("#html-box textarea").val();$("section.present:not(.stack)").html(a),$("#html-box").modal("close")}}]})})},init:function(){this.initSlideDetail(),this.initTopbar(),this.initRightbar(),this.bindEvent(),$("section").prop("contenteditable",!0)}};g.init()}();